<link rel="import"
  href="/bower_components/paper-button/paper-button.html">
<link rel="import"
  href="/bower_components/core-ajax/core-ajax.html">



<polymer-element name="bsd-form">
  <template>
    <form>
      <bsd-endpoint label="From"></bsd-endpoint>
      <paper-input-decorator label="To" autoValidate=true>
        <input id="to"
          is="core-input"
          value={{destination}}
          on-keyup={{keyHandler}}
          required>
      </paper-input-decorator>
      <bsd-geocoder address={{destination}} location={{geoDestination}} for="to"></bsd-geocoder>
      <paper-button
        id="submit"
        on-click={{submit}}
        disabled={{!formIsValid}}
        raised>
        Go
      </paper-button>
      <core-ajax
        id="submitAJAX"
        url="/query"
        params='{"origin":"{{geoOrigin}}", "destination":"{{geoDestination}}"}'
        handleAs="json"
        response="{{directions}}"
        on-core-response="{{showMap}}">
      </core-ajax>
    </form>
  </template>
  <script>
    Polymer({
      formIsValid: false,
      keyHandler: function(e) {
        this.formIsValid = this.$.from.checkValidity() && this.$.to.checkValidity();

        if (e.keyCode === 13 && this.formIsValid) {
          this.$.submit.click();
        }
      },
      geoDone: function(e) {
        if (e.detail.err) {
          console.log('Error');
        }
      },
      submit: function(e) {
        if (this.geoOrigin !== undefined && this.geoDestination !== undefined) {
          this.$.submitAJAX.go();
        } else {
          console.log('Error submitting');
        }
      },
      showMap: function() {
        console.log(this.directions);
      }
    });
  </script>
</polymer-element>

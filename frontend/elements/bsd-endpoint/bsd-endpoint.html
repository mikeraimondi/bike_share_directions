<link rel="import"
  href="/bower_components/paper-spinner/paper-spinner.html">
<link rel="import"
  href="/bower_components/core-ajax/core-ajax.html">

<link rel="import"
  href="/elements/bsd-geocoder/bsd-geocoder.html">

<polymer-element name="bsd-endpoint" attributes="label stations">
  <template>
    <bsd-geocoder
      id="geocoder"
      location="{{endpointLocation}}"
      label="{{label}}"
      located={{located}}>
    </bsd-geocoder>
    <core-ajax
      id="submitAJAX"
      url="/query"
      params='{"lat":"{{lat}}", "lng":"{{lng}}"}'
      handleAs="json"
      on-core-response="{{onResponse}}">
    </core-ajax>
    <paper-spinner active="{{isLoading}}"></paper-spinner>
  </template>
  <script>
    Polymer({
      stations: [],
      endpointLocationChanged: function() {
        if (this.$.geocoder.located && this.endpointLocation) {
          this.isLoading = true;
          this.lat = this.endpointLocation.lat();
          this.lng = this.endpointLocation.lng();
          this.$.submitAJAX.go();
        }
      },
      onResponse: function() {
        this.stations = this.$.submitAJAX.response
        this.isLoading = false;
      }
    });
  </script>
</polymer-element>

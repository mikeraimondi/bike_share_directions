<link rel="import"
  href="/bower_components/google-map/google-map.html">

<link rel="import"
  href="/elements/bsd-globals/bsd-globals.html">
<link rel="import"
  href="/elements/bsd-endpoint/bsd-endpoint.html">

<polymer-element name="bsd-main">
  <template>
    <bsd-globals id="globals" lat={{startLat}} lng={{startLng}}></bsd-globals>
    <bsd-endpoint id="origin" label="From" stations="{{originStations}}"></bsd-endpoint>
    <bsd-endpoint id="destination" label="To" stations="{{destinationStations}}"></bsd-endpoint>
    <template if={{showMap}}>
      <google-map id="map"
        fitToMarkers=true
        apiKey="AIzaSyAaulJg7NxcxI-zZMoPOqTce91cyXy3bfw"
        latitude={{startLat}}
        longitude={{startLng}}
        signedIn>
        <template if={{$.origin.located}}>
          <google-map-marker latitude="{{$.origin.lat}}"
            longitude="{{$.origin.lng}}"
            title="Origin">
            <p>Origin</p>
          </google-map-marker>
        </template>
        <template if={{$.destination.located}}>
          <google-map-marker latitude="{{$.destination.lat}}"
            longitude="{{$.destination.lng}}"
            title="Destination">
            <p>Destination</p>
          </google-map-marker>
        </template>
        <template repeat="{{station in stations}}">
          <google-map-marker latitude="{{station.Lat}}"
            longitude="{{station.Lng}}"
            title="{{station.Name}}">
            <p>{{station.Name}}</p>
            <ul>
              <li>Bikes: {{station.Bikes}}</li>
              <li>Empty Docks: {{station.EmptyDocks}}</li>
            </ul>
          </google-map-marker>
        </template>
      </google-map>
    </template>
  </template>
  <script>
    Polymer({
      stations: [],
      originStationsChanged: function() {
        if (this.originStations.length > 0) {
          this.showMap = true;
        }
        this.stations = this.originStations.concat(this.destinationStations);
      },
      destinationStationsChanged: function() {
        if (this.destinationStations.length > 0) {
          this.showMap = true;
        }
        this.stations = this.originStations.concat(this.destinationStations);
      }
    });
  </script>
</polymer-element>
